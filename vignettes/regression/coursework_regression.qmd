---
title: "Understanding costs"
author: "Anonymous"
format: 
  html:
    embed-resources: true
    math: mathjax
---

## Your task

This material is provided as context to the problem. You should rewrite it as you see fit.

## The Problem

Data on [Energy Certificates](https://epc.opendatacommunities.org/) were downloaded in March 2025. These certificates are a non-random sample of UK housing, and contain information such as:

-   Property energy efficiency: The core data is the energy efficiency rating, which ranges from A (most efficient) to G (least efficient).
-   CO2 emissions: The data includes information on the building's likely carbon dioxide emissions.
-   Energy costs: Potential costs for heating and lighting the property are provided.
-   Improvement recommendations: Each EPC lists cost-effective ways to improve the building's energy performance.

We have been asked by a local company to determine whether some local authorities are better than others in terms of reducing the carbon footprint of properties in their area. However, some authorities have older housing stock which is innately has a larger carbon footprint. Likewise, some have larger properties than others. The initial brief is to carry out an aggregate data analysis where the unit of analysis is a local authority. We have been asked to consider the average carbon footprint of a house in a given area conditional on being pre- or post-1930 and having between 1 and 10 heated rooms. This should let you fit a model which has fixed effects for the number of houses of pre-1930, post-1930 and 1, 2, 3, ..., 10 heated rooms

$$Y_{ji} = \beta_0 + \beta_1 x_{j}^{(\text{old})} + \sum_{r=1}^{10} \beta_r x_{j}^{(r)} + \gamma_j$$

Where

-   $Y_{ji}$ is the average carbon dioxide emissions for authority $j$ for each house type $i$ (old/new, 1, 2, ..., 10 rooms)
-   $x_{j}^{(old)}$ is the number of houses that are older than 1930 in authority $j$
-   $x_{j}^r$ are the number of houses with $r=1, 2, ..., 10$ rooms in authority $j$
-   $\beta_0$, $\beta_1$, $\beta_r$ are the fixed effects
-   $\gamma_j$ is the random effect for local authority $j$

## The Data

Some initial exploratory data analysis shows us how the carbon emissions vary by age of property and by the number of rooms:

![](../../data_cache/vignettes/regression/boxplot_age.html){width="100%" height="600px"}

From the boxplots we are able to see that the older homes have a tendency to emit higher levels of CO2 emissions than recent homes. This makes intuitive sense as newer homes will have been built with new energy efficiency methods implemented.

This plot is insightful and appropriate as house age is a categorical variable which are visualised well through boxplots when compared to a continuous variable such as shortfall (CO2 emissions).

![](../../data_cache/vignettes/regression/boxplot_rooms.html){width="100%" height="600px"}

We can see that there is a clear relationship between shortfall and n_rooms with a consistent increase in central tendencies of shortfall, increasing as the number of rooms increase. This is a strong indication that this variable will have strong predictive power in our model.

## The model

The hierarchical model is appropriate here as the standard linear regression model assumes that each observation is independent which is not the case, as there are natural hierarchies in the data. The houses within the local authorities will be similar and won't be fully independent, therefore we need to account for this by accounting for the local authority code as a random effect. The use of random effects in the model we are training will allow each authority code to have its own intercept. 

A model can be fitted and a summary of the fixed effects produced

```{python}
#| echo: false
#| eval: true
#| results: 'asis'
with open('../../data_cache/vignettes/regression/model_fit.txt') as f:
    content = f.read()
    print(content)
```

The summary statistics shows us that recent properties have significantly lower shortfall than older ones, with a coefficient of -2.98, indicating that a property in the recent age category will reduce the shortfall expected by around 3 units. The number of rooms has a strong positive effect on shortfall, with each additional room increasing shortfall by around 1.05 units. Both predictors are statistically significant with both p-values being below the 0.05 threshold, this is further supported by the confidence intervals not crossing 0.

The random intercept variance of the group variable (local authority) of 0.434 suggests to us that there is a meaningful variation between authorities in shortfall, indicating to us that it is a suitable random effect to model for.

## The key insight

From the caterpillar plot below we can see further evidence of the variation in local authority shortfall. We can see effects from around -2.8 to 3.2, indicating a meaningful difference in shortfall of local authorities when accounting for the fixed effects (n_rooms and age category).

![](../../data_cache/vignettes/regression/caterpillar.html){width="100%" height="600px"}


## Record of AI use for MTHM503 Regression coursework

Instructions: You can use this document to record when, how and why you used GenAI to complete your assessment. It will help you create a record of AI use to submit alongside your references for AI-integrated and AI-assisted assignments. It may also be useful to help you discuss your AI use if you are required to do so in an academic conduct meeting.

| **Date** | **AI tool used** | **Purpose** | **Prompt** | **Hyperlink to output (where possible)** | **Section of work used for** |
|----|----|----|----|----|----|
| E.g. 15/07/2025 | MS Copilot | To help create an organised essay structure | ‘Generate ideas for structuring an essay on...’ | \[insert link\] | introduction |
| 12/12/2025 |  Chat GPT|  Assisted with solving Lint Errors|  code errors and code snipped|  no link avaialbe (desktop)|  code base|
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
